# פיצ'ר עריכה ידנית של מדידות זמן

## תאריך: 08/02/2026

## סקירה כללית

פיצ'ר זה מוסיף יכולות עריכה, הוספה ומחיקה ידנית של רשומות מדידת זמן במערכת.

## יכולות חדשות

### 1. עריכת רשומה קיימת
- עריכת שעת התחלה וסיום
- עדכון הערות
- חישוב אוטומטי של משך הזמן בעת שינוי הזמנים

### 2. הוספת רשומה ידנית
- בחירת לקוח, פרויקט ומשימה
- הגדרת תאריך ומשך זמן
- אפשרות לבחירת עובד (למנהלים בלבד)
- הוספת הערה

### 3. התאמת שעות
- הוספה או הורדה של שעות מרשומה קיימת
- ממשק נוח עם כפתורי +/- בקפיצות של 0.5 שעות
- תצוגה מקדימה של התוצאה הסופית

### 4. מחיקת רשומה
- מחיקת רשומות זמן עם אישור
- הרשאות: רק הבעלים או מנהלים יכולים למחוק

## API Endpoints חדשים

### PUT `/api/time_tracking/entry/<entry_id>`
עדכון רשומת זמן קיימת.

**פרמטרים:**
- `start_time` (string, ISO format) - שעת התחלה חדשה
- `end_time` (string, ISO format) - שעת סיום חדשה
- `note` (string) - הערה
- `duration_hours` (number) - משך זמן בשעות

**הרשאות:** בעלים או מנהל

---

### DELETE `/api/time_tracking/entry/<entry_id>`
מחיקת רשומת זמן.

**הרשאות:** בעלים או מנהל

---

### POST `/api/time_tracking/manual`
הוספת רשומת זמן ידנית.

**פרמטרים (חובה):**
- `client_id` (string) - מזהה לקוח
- `project_id` (string) - מזהה פרויקט
- `task_id` (string) - מזהה משימה
- `date` (string, YYYY-MM-DD) - תאריך
- `duration_hours` (number) - משך זמן בשעות

**פרמטרים (אופציונלי):**
- `user_id` (string) - מזהה עובד (למנהלים בלבד)
- `note` (string) - הערה
- `start_time` (string, ISO) - שעת התחלה
- `end_time` (string, ISO) - שעת סיום

---

### POST `/api/time_tracking/adjust/<entry_id>`
התאמת שעות ברשומה קיימת.

**פרמטרים:**
- `adjustment_hours` (number) - כמות שעות להוספה/הורדה (חיובי/שלילי)

**הרשאות:** בעלים או מנהל

## קבצים שהשתנו

### Backend
- `app.py` - הוספת 4 API routes חדשים

### Frontend
- `src/pages/TimeTrackingReports.tsx` - הוספת:
  - מודל עריכת רשומה (Edit Modal)
  - מודל הוספה ידנית (Add Manual Entry Modal)
  - מודל התאמת שעות (Adjust Hours Modal)
  - דיאלוג אישור מחיקה
  - כפתורי פעולות בטבלת הרשומות

## ממשק משתמש

### כפתורים בטבלת הרשומות
| כפתור | פעולה | צבע |
|--------|--------|------|
| ⊕ | התאמת שעות | כחול |
| ✎ | עריכה | אפור |
| 🗑 | מחיקה | אדום |

### כפתור הוספה ידנית
כפתור "הוספה ידנית" בראש הדף מאפשר הוספת רשומות חדשות.

## הרשאות

| פעולה | בעלים | עובד רגיל | מנהל | אדמין |
|--------|--------|-----------|-------|--------|
| עריכת רשומה שלו | ✓ | ✓ | ✓ | ✓ |
| עריכת רשומה של אחר | ✗ | ✗ | ✓ | ✓ |
| מחיקת רשומה שלו | ✓ | ✓ | ✓ | ✓ |
| מחיקת רשומה של אחר | ✗ | ✗ | ✓ | ✓ |
| הוספה ידנית לעצמו | ✓ | ✓ | ✓ | ✓ |
| הוספה ידנית לאחר | ✗ | ✗ | ✓ | ✓ |

## שימוש

### עריכת רשומה
1. בדף דוחות מדידת זמן (`/time_tracking`)
2. לחץ על אייקון העריכה (✎) בשורת הרשומה
3. עדכן את הזמנים/הערה
4. לחץ "שמור שינויים"

### הוספה ידנית
1. לחץ על כפתור "הוספה ידנית" בראש הדף
2. בחר לקוח → פרויקט → משימה
3. הגדר תאריך ומשך זמן
4. לחץ "הוסף רשומה"

### התאמת שעות
1. לחץ על אייקון ההתאמה (⊕) בשורת הרשומה
2. השתמש בכפתורי +/- להוספה או הורדה של שעות
3. לחץ "הוסף שעות" או "הורד שעות"

### מחיקת רשומה
1. לחץ על אייקון המחיקה (🗑) בשורת הרשומה
2. אשר את המחיקה בדיאלוג

## הערות טכניות

- רשומות שנוספו ידנית מסומנות בשדה `manual_entry: true`
- התאמות שעות מתועדות בשדה ההערה
- הזמנים נשמרים בפורמט ISO עם UTC
- משך הזמן מחושב מחדש בעת שינוי הזמנים
