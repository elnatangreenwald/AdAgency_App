<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ×¦×•×•×ª | ×•×ª×§×™×Ÿ ×‘×•×˜×™×§</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='common_styles.css') }}">
    <style>
        .container { max-width: 900px; margin: auto; }
        h1 {
            color: #292f4c;
            font-size: 2.2rem;
            margin-bottom: 30px;
        }
        h2 { 
            border-bottom: 3px solid var(--primary); 
            padding-bottom: 10px; 
            margin-bottom: 20px; 
            color: #292f4c; 
            font-size: 1.8rem; 
        }
        .form-group { 
            margin-bottom: 15px; 
            display: flex; 
            gap: 10px; 
            flex-wrap: wrap; 
        }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            font-size: 0.9rem; 
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="/" class="sidebar-logo"><img src="{{ url_for('static', filename='Vatkin_Logo.jpg') }}"></a>
        <a href="/" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            ×“×©×‘×•×¨×“
        </a>
        <div class="nav-item">
            <a href="/all_clients" class="nav-link active">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                ×œ×•×— ×œ×§×•×—×•×ª
            </a>
            <div class="users-dropdown">
                {% for uid, info in sidebar_users.items() %}
                <a href="/all_clients?user={{ uid }}" class="user-sub-link">â€¢ {{ info.name }}</a>
                {% endfor %}
            </div>
        </div>
        <a href="/finance" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
            ×›×¡×¤×™×
        </a>
        <a href="/events" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            ××™×¨×•×¢×™×
        </a>
        <a href="/suppliers" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            ×¡×¤×§×™×
        </a>
        <a href="/quotes" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            ×”×¦×¢×•×ª ××—×™×¨
        </a>
        <a href="/forms" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
            ×˜×¤×¡×™×
        </a>
        {% if current_user.id == 'admin' %}
        <a href="/admin/users" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path></svg>
            × ×™×”×•×œ ×¦×•×•×ª
        </a>
        {% endif %}
        <div class="sidebar-user-area">
            <div class="sidebar-user-name">{{ current_user.name }}</div>
            <a href="/logout" class="sidebar-logout-link">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                ×”×ª× ×ª×§
            </a>
        </div>
    </div>
    <div class="container">
        <h1>× ×™×”×•×œ ×¦×•×•×ª ×•×”×§×¦××•×ª</h1>

        <div class="card">
            <h2>+ ×”×•×¡×¤×ª ×¢×•×‘×“ ×—×“×©</h2>
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <input type="hidden" name="action" value="add_user">
                <div class="form-group">
                    <input type="text" name="name" placeholder="×©× ××œ×" required>
                    <input type="email" name="email" placeholder="××™×™×œ" required>
                    <input type="password" name="email_password" placeholder="×¡×™×¡××ª ××™×™×œ" required>
                    <input type="text" name="username" placeholder="×©× ××©×ª××© (×œ×›× ×™×¡×”)" required>
                    <input type="password" name="password" placeholder="×¡×™×¡××” ×œ××¢×¨×›×ª" required>
                    <select name="role" required style="padding: 12px; border: 2px solid #e6e9ef; border-radius: 8px; font-size: 1rem;">
                        <option value="×¢×•×‘×“">×¢×•×‘×“</option>
                        <option value="×× ×”×œ">×× ×”×œ</option>
                        <option value="××“××™×Ÿ">××“××™×Ÿ</option>
                    </select>
                    <button type="submit" class="btn-black">×¦×•×¨ ××©×ª××©</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>ğŸ”— ×©×™×•×š ×œ×§×•×—</h2>
            <form method="POST" id="assignForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <input type="hidden" name="action" value="assign">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <label>×‘×—×¨ ×œ×§×•×—:</label>
                        <select name="client_id" id="assignClientSelect" style="width: 100%;" onchange="updateAssignedUsersPreview()">
                            {% for c in clients %}
                                <option value="{{ c.id }}">{{ c.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label>×©×™×™×š ×œ×¢×•×‘×“×™× (× ×™×ª×Ÿ ×œ×‘×—×•×¨ ×›××”):</label>
                        <div id="usersCheckboxes" style="max-height: 200px; overflow-y: auto; padding: 12px; border: 2px solid #e6e9ef; border-radius: 8px; background: white;">
                            {% for uid, info in users.items() %}
                                {% if uid != 'admin' %}
                                <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s; margin-bottom: 4px;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" name="user_ids" value="{{ uid }}" class="user-checkbox" style="width: 18px; height: 18px; cursor: pointer; accent-color: #043841;">
                                    <span style="font-size: 0.95rem; color: #292f4c;">{{ info.name }}</span>
                                </label>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div id="currentAssignedUsers" style="margin-top: 10px; padding: 8px; background: #f1f5f9; border-radius: 6px; font-size: 0.9rem; color: #475569;"></div>
                    </div>
                </div>
                <button type="submit" class="btn" style="margin-top: 20px; width: 100%;">×‘×¦×¢ ×©×™×•×š</button>
            </form>
        </div>
        <script>
            function updateAssignedUsersPreview() {
                const clientId = document.getElementById('assignClientSelect').value;
                const allClients = {{ clients | tojson }};
                const client = allClients.find(c => c.id === clientId);
                const preview = document.getElementById('currentAssignedUsers');
                const allUsers = {{ users | tojson }};
                const checkboxes = document.querySelectorAll('.user-checkbox');
                
                // ××¤×¡ ××ª ×›×œ ×”×ª×™×‘×•×ª
                checkboxes.forEach(cb => cb.checked = false);
                
                if (client && client.assigned_user) {
                    const assigned = Array.isArray(client.assigned_user) ? client.assigned_user : [client.assigned_user];
                    if (assigned.length > 0) {
                        // ×¡××Ÿ ××ª ×”×ª×™×‘×•×ª ×©×œ ×”×¢×•×‘×“×™× ×”××©×•×™×›×™×
                        assigned.forEach(uid => {
                            const checkbox = document.querySelector(`.user-checkbox[value="${uid}"]`);
                            if (checkbox) {
                                checkbox.checked = true;
                            }
                        });
                        
                        const names = assigned.map(uid => allUsers[uid] ? allUsers[uid].name : uid).join(', ');
                        preview.innerHTML = '<strong>×©×•×™×š ×›×¨×’×¢ ×œ:</strong> ' + names;
                    } else {
                        preview.innerHTML = '<em>××™×Ÿ ×©×™×•×š ×›×¨×’×¢</em>';
                    }
                } else {
                    preview.innerHTML = '<em>××™×Ÿ ×©×™×•×š ×›×¨×’×¢</em>';
                }
            }
            // ×˜×¢×Ÿ ××ª ×”×ª×¦×•×’×” ×”×¨××©×•× ×™×ª
            updateAssignedUsersPreview();
        </script>
        
        <div class="card" style="margin-top: 30px;">
            <h2>×¨×©×™××ª ×¢×•×‘×“×™×</h2>
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead>
                    <tr style="border-bottom: 2px solid #e6e9ef;">
                        <th style="padding: 12px; text-align: right; font-weight: 700;">×©×</th>
                        <th style="padding: 12px; text-align: right; font-weight: 700;">××™×™×œ</th>
                        <th style="padding: 12px; text-align: right; font-weight: 700;">×¡×™×¡××ª ××™×™×œ</th>
                        <th style="padding: 12px; text-align: right; font-weight: 700;">×©× ××©×ª××©</th>
                        <th style="padding: 12px; text-align: right; font-weight: 700;">×ª×¤×§×™×“</th>
                        <th style="padding: 12px; text-align: right; font-weight: 700;">×¡×™×¡××”</th>
                        <th style="padding: 12px; text-align: center; font-weight: 700;">×¤×¢×•×œ×•×ª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for uid, info in users.items() %}
                    <tr style="border-bottom: 1px solid #e6e9ef;">
                        <td style="padding: 15px; color: #292f4c; font-weight: bold;">{{ info.name }}</td>
                        <td style="padding: 15px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="email" 
                                       id="email_{{ uid }}" 
                                       value="{{ info.get('email', '') }}" 
                                       placeholder="××™×Ÿ ××™×™×œ"
                                       onkeypress="if(event.key==='Enter') updateEmail('{{ uid }}', this.value)"
                                       style="padding: 6px 12px; border: 2px solid #e6e9ef; border-radius: 6px; font-size: 0.9rem; width: 200px; font-family: 'Heebo', sans-serif;">
                                <button onclick="updateEmail('{{ uid }}', document.getElementById('email_{{ uid }}').value)" 
                                        class="btn" 
                                        style="background: #28a745; color: white; padding: 6px 12px; font-size: 0.85rem;">ğŸ’¾ ×©××•×¨</button>
                            </div>
                        </td>
                        <td style="padding: 15px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="password" 
                                       id="email_password_{{ uid }}" 
                                       placeholder="×¡×™×¡××ª ××™×™×œ"
                                       onkeypress="if(event.key==='Enter') updateEmailPassword('{{ uid }}', this.value)"
                                       style="padding: 6px 12px; border: 2px solid #e6e9ef; border-radius: 6px; font-size: 0.9rem; width: 180px; font-family: 'Heebo', sans-serif;">
                                <button onclick="updateEmailPassword('{{ uid }}', document.getElementById('email_password_{{ uid }}').value)" 
                                        class="btn" 
                                        style="background: #007bff; color: white; padding: 6px 12px; font-size: 0.85rem;">ğŸ’¾ ×©××•×¨</button>
                            </div>
                        </td>
                        <td style="padding: 15px; color: #64748b; font-family: 'Heebo', monospace;">{{ uid }}</td>
                        <td style="padding: 15px;">
                            {% if uid == 'admin' %}
                                <span style="background: #d66b74; color: white; padding: 6px 12px; border-radius: 6px; font-weight: bold; font-size: 0.85rem;">××“××™×Ÿ</span>
                            {% else %}
                                <select onchange="updateRole('{{ uid }}', this.value)" style="padding: 6px 12px; border: 2px solid #e6e9ef; border-radius: 6px; font-size: 0.9rem; min-width: 100px;">
                                    <option value="×¢×•×‘×“" {% if info.get('role', '×¢×•×‘×“') == '×¢×•×‘×“' %}selected{% endif %}>×¢×•×‘×“</option>
                                    <option value="×× ×”×œ" {% if info.get('role', '×¢×•×‘×“') == '×× ×”×œ' %}selected{% endif %}>×× ×”×œ</option>
                                    <option value="××“××™×Ÿ" {% if info.get('role', '×¢×•×‘×“') == '××“××™×Ÿ' %}selected{% endif %}>××“××™×Ÿ</option>
                                </select>
                            {% endif %}
                        </td>
                        <td style="padding: 15px; color: #64748b; font-family: 'Heebo', monospace;">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</td>
                        <td style="padding: 15px; text-align: center;">
                            {% if uid != 'admin' %}
                            <div style="display: flex; gap: 10px; justify-content: center; align-items: center;">
                                <button onclick="resetPassword('{{ uid }}', '{{ info.name }}')" class="btn" style="background: #ffc107; color: #000; padding: 8px 16px; font-size: 0.9rem;">ğŸ”„ ××™×¤×•×¡ ×¡×™×¡××”</button>
                                <button onclick="deleteUser('{{ uid }}', '{{ info.name }}')" class="btn" style="background: #dc3545; color: white; padding: 8px 16px; font-size: 0.9rem;">ğŸ—‘ï¸ ××—×§</button>
                            </div>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    {% if users|length <= 1 %}
                    <tr>
                        <td colspan="7" style="padding: 30px; text-align: center; color: #999;">××™×Ÿ ×¢×•×‘×“×™× ×‘××¢×¨×›×ª</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <div class="card" style="margin-top: 30px;">
            <h2>ğŸ” ×”×¨×©××•×ª ×“×¤×™×</h2>
            <p style="color: #64748b; margin-bottom: 20px;">×”×’×“×¨ ××™×–×” ×ª×¤×§×™×“ × ×“×¨×© ×œ×’×©×ª ×œ×›×œ ×“×£ ×‘××¢×¨×›×ª</p>
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead>
                    <tr style="border-bottom: 2px solid #e6e9ef;">
                        <th style="padding: 12px; text-align: right; font-weight: 700;">×“×£</th>
                        <th style="padding: 12px; text-align: right; font-weight: 700;">Route</th>
                        <th style="padding: 12px; text-align: right; font-weight: 700;">×”×¨×©××” × ×“×¨×©×ª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for page in all_pages %}
                    <tr style="border-bottom: 1px solid #e6e9ef;">
                        <td style="padding: 15px; color: #292f4c; font-weight: bold;">{{ page.name }}</td>
                        <td style="padding: 15px; color: #64748b; font-family: 'Heebo', monospace; font-size: 0.9rem;">{{ page.route }}</td>
                        <td style="padding: 15px;">
                            <select onchange="updatePermission('{{ page.route }}', this.value)" style="padding: 6px 12px; border: 2px solid #e6e9ef; border-radius: 6px; font-size: 0.9rem; min-width: 120px;">
                                <option value="×¢×•×‘×“" {% if permissions.get(page.route, '×¢×•×‘×“') == '×¢×•×‘×“' %}selected{% endif %}>×¢×•×‘×“ (×›×•×œ×)</option>
                                <option value="×× ×”×œ" {% if permissions.get(page.route, '×¢×•×‘×“') == '×× ×”×œ' %}selected{% endif %}>×× ×”×œ (×× ×”×œ+××“××™×Ÿ)</option>
                                <option value="××“××™×Ÿ" {% if permissions.get(page.route, '×¢×•×‘×“') == '××“××™×Ÿ' %}selected{% endif %}>××“××™×Ÿ (×¨×§ ××“××™×Ÿ)</option>
                            </select>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Modal ×œ××™×¤×•×¡ ×¡×™×¡××” -->
    <div id="resetPasswordModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="resetPasswordTitle">××™×¤×•×¡ ×¡×™×¡××”</h2>
                <span class="close" onclick="closeResetPasswordModal()" style="font-size: 2rem; cursor: pointer;">&times;</span>
            </div>
            <form id="resetPasswordForm" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <input type="hidden" name="action" value="reset_password">
                <input type="hidden" name="user_id" id="resetPasswordUserId">
                <div class="form-group" style="flex-direction: column; align-items: stretch;">
                    <label style="margin-bottom: 8px;">×¡×™×¡××” ×—×“×©×”:</label>
                    <input type="password" name="new_password" id="resetPasswordInput" placeholder="×”×–×Ÿ ×¡×™×¡××” ×—×“×©×”" required style="padding: 12px; border: 2px solid #e6e9ef; border-radius: 8px; font-size: 1rem; width: 100%; box-sizing: border-box;">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="closeResetPasswordModal()" class="btn" style="background: #6c757d; color: white; padding: 10px 20px;">×‘×™×˜×•×œ</button>
                    <button type="submit" class="btn" style="background: #ffc107; color: #000; padding: 10px 20px;">××™×©×•×¨ ××™×¤×•×¡</button>
                </div>
            </form>
        </div>
    </div>
    
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            right: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e6e9ef;
            padding-bottom: 15px;
        }
        
        .close {
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }
        
        .close:hover {
            color: #333;
        }
        
        table tr:hover {
            background: #f8fafc;
        }
    </style>
    
    <script>
        function resetPassword(userId, userName) {
            document.getElementById('resetPasswordUserId').value = userId;
            document.getElementById('resetPasswordTitle').textContent = `××™×¤×•×¡ ×¡×™×¡××” - ${userName}`;
            document.getElementById('resetPasswordInput').value = '';
            document.getElementById('resetPasswordModal').style.display = 'block';
        }
        
        function closeResetPasswordModal() {
            document.getElementById('resetPasswordModal').style.display = 'none';
        }
        
        window.onclick = function(event) {
            const modal = document.getElementById('resetPasswordModal');
            if (event.target == modal) {
                closeResetPasswordModal();
            }
        }
        
        function updateRole(userId, newRole) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
            const form = document.createElement('form');
            form.method = 'POST';
            form.innerHTML = `
                <input type="hidden" name="csrf_token" value="${csrfToken}">
                <input type="hidden" name="action" value="update_role">
                <input type="hidden" name="user_id" value="${userId}">
                <input type="hidden" name="role" value="${newRole}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
        
        function updatePermission(route, requiredRole) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
            const form = document.createElement('form');
            form.method = 'POST';
            form.innerHTML = `
                <input type="hidden" name="csrf_token" value="${csrfToken}">
                <input type="hidden" name="action" value="update_permission">
                <input type="hidden" name="route" value="${route}">
                <input type="hidden" name="required_role" value="${requiredRole}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
        
        function updateEmail(userId, email) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]') ? document.querySelector('meta[name="csrf-token"]').content : '';
            const form = document.createElement('form');
            form.method = 'POST';
            form.innerHTML = `
                <input type="hidden" name="csrf_token" value="${csrfToken}">
                <input type="hidden" name="action" value="update_email">
                <input type="hidden" name="user_id" value="${userId}">
                <input type="hidden" name="email" value="${email}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
        
        function updateEmailPassword(userId, emailPassword) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]') ? document.querySelector('meta[name="csrf-token"]').content : '';
            const form = document.createElement('form');
            form.method = 'POST';
            form.innerHTML = `
                <input type="hidden" name="csrf_token" value="${csrfToken}">
                <input type="hidden" name="action" value="update_email_password">
                <input type="hidden" name="user_id" value="${userId}">
                <input type="hidden" name="email_password" value="${emailPassword}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
        
        function deleteUser(userId, userName) {
            if (!confirm(`×”×× ××ª×” ×‘×˜×•×— ×©××ª×” ×¨×•×¦×” ×œ××—×•×§ ××ª ×”××©×ª××© "${userName}"?\n×¤×¢×•×œ×” ×–×• ×ª×¡×™×¨ ××ª ×”××©×ª××© ××›×œ ×”×©×™×•×›×™× ×©×œ ×œ×§×•×—×•×ª.\n×¤×¢×•×œ×” ×–×• ××™× ×” ×”×¤×™×›×”!`)) {
                return;
            }
            
            const csrfToken = document.querySelector('meta[name="csrf-token"]') ? document.querySelector('meta[name="csrf-token"]').content : '';
            const form = document.createElement('form');
            form.method = 'POST';
            form.innerHTML = `
                <input type="hidden" name="csrf_token" value="${csrfToken}">
                <input type="hidden" name="action" value="delete_user">
                <input type="hidden" name="user_id" value="${userId}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
    </script>
    {% include '_chat_widget.html' %}
</body>
</html>