<!-- Chat Button and Modal -->
<link rel="stylesheet" href="{{ url_for('static', filename='chat.css') }}">
<script src="{{ url_for('static', filename='chat.js') }}"></script>
<script>
    var currentUserId = '{{ current_user.id }}';
</script>
<button class="chat-button" onclick="ChatManager.openChat()" title="תמיכה והדרכה">
    <img src="{{ url_for('static', filename='Vatkin_Logo.jpg') }}" alt="Chat" class="chat-logo-icon">
    <span class="chat-button-badge" id="chatUnreadBadge" style="display: none;">0</span>
</button>

<div id="chatModal" class="chat-modal">
    <div class="chat-header">
        <div class="chat-header-content">
            <span class="chat-header-emoji">👋</span>
            <div class="chat-header-text">
                <h2 class="chat-header-title">שלום</h2>
                <p class="chat-header-subtitle">מה תרצו להגיד היום?</p>
                <p class="chat-header-hours">זמני הפעילות: ימים א-ה בשעות 9:00-17:00</p>
            </div>
        </div>
        <button class="chat-close-btn" onclick="ChatManager.closeChat()">×</button>
    </div>
    <div class="chat-body">
        <!-- Users List Section -->
        <div id="chatUsersSection">
            <div class="chat-new-conversation-header">
                <h3 class="chat-new-conversation-title">התחלת שיחה חדשה</h3>
                <div class="chat-user-selection" id="chatUserSelection">
                    <select id="chatUserSelect" class="chat-user-select" onchange="ChatManager.selectUserForNewConversation(this.value)">
                        <option value="">-- בחר משתמש לשיחה חדשה --</option>
                    </select>
                </div>
            </div>
            <div class="chat-users-list" id="chatUsersList">
                <!-- Users will be loaded here -->
            </div>
        </div>
        
        <!-- Messages Section -->
        <div id="chatMessagesSection">
            <div class="chat-messages-header">
                <button class="chat-back-btn" onclick="ChatManager.backToUsers()">←</button>
                <div class="chat-user-avatar" id="chatWithUserAvatar"></div>
                <div>
                    <div style="font-weight: bold; color: #292f4c;" id="chatWithUserName"></div>
                    <div style="font-size: 12px; color: #64748b;">מחובר כעת</div>
                </div>
            </div>
            <div id="chatMessagesContainer">
                <!-- Messages will be loaded here -->
            </div>
            <div class="chat-input-container">
                <input type="file" id="chatFileInput" style="display: none;" multiple onchange="ChatManager.handleFileSelect(event)">
                <button class="chat-file-btn" onclick="document.getElementById('chatFileInput').click()" title="הוסף קובץ">
                    📎
                </button>
                <div class="chat-input-wrapper">
                    <textarea id="chatMessageInput" placeholder="הקלד הודעה..." rows="1"></textarea>
                    <button class="chat-send-btn" onclick="ChatManager.sendMessage()">→</button>
                </div>
            </div>
            <div id="chatFilesPreview" class="chat-files-preview" style="display: none;"></div>
        </div>
    </div>
</div>

